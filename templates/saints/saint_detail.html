{% extends "base.html" %}
{% load static %}

{% block title %}{{ saint.name|default:"Unnamed Saint" }} - MapLoS Cy{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
{% endblock %}

{% block content %}
<a href="{% url 'saint-list' %}" class="back-btn">
    <i class="fas fa-arrow-left me-1"></i>Back to Saints
</a>

<div class="detail-container">
    <!-- Left Column -->
    <div class="detail-left">
        {% with image=saint.get_default_image %}
        {% if image %}
        <img src="{{ image.image.url }}" alt="Portrait of {{ saint.name|default:'Saint' }}">
        {% else %}
        <img src="{% static 'placeholder.png' %}" alt="No image available">
        {% endif %}
        {% endwith %}
    </div>

    <!-- Right Column -->
    <div class="detail-right">
        <h1>{{ saint.name|default:"Unnamed Saint" }}</h1>

        <div><strong>Gender:</strong> {{ saint.gender|default:"Not specified" }}</div>
        <div><strong>Type:</strong> {{ saint.type_of_saint|default:"Not specified" }}</div>

        <div>
            <strong>Active period:</strong>
            {% if saint.act_period_1 %}{{ saint.act_period_1 }}{% endif %}
            {% if saint.act_period_2 %}, {{ saint.act_period_2 }}{% endif %}
            {% if saint.act_period_text %} ({{ saint.act_period_text }}){% endif %}
            {% if not saint.act_period_1 and not saint.act_period_2 and not saint.act_period_text %}
            Not specified
            {% endif %}
        </div>

        <div><strong>Region of Birth:</strong> {{ saint.region_of_birth|default:"Not specified" }}</div>
        <div><strong>Region of Burial:</strong> {{ saint.region_of_burial|default:"Not specified" }}</div>

        {% if saint.feast_day %}
        <div><strong>Feast Day:</strong> {{ saint.feast_day }}</div>
        {% endif %}

        <!-- Map -->
        <div class="section-title">Locations Map - Cyprus</div>
        <div id="saint-map"></div>

        <!-- Hagiographies -->
        <div class="section-title">Hagiographies / Written Sources</div>
        <ul>
            {% for h in saint.hagiographies.all %}
            <li>
                <strong>Literary:</strong> {{ h.title_literary_text|default:"Not specified" }}<br>
                <strong>Century:</strong> {{ h.date_or_century_of_source|default:"Not specified" }}<br>
                <strong>Type:</strong> {{ h.literary_source_type|default:"Not specified" }}<br><br>
                <strong>Liturgical:</strong> {{ h.title_liturgical_text|default:"Not specified" }}<br>
                <strong>Century:</strong> {{ h.date_or_century_of_liturgical_source|default:"Not specified" }}<br>
                <strong>Type:</strong> {{ h.liturgical_texts_source_type|default:"Not specified" }}
            </li>
            {% empty %}
            <li>No hagiographies available.</li>
            {% endfor %}
        </ul>

        <!-- Aspects of Cult -->
        <div class="section-title">Aspects of Cult</div>
        <ul>
            {% for aspect in saint.cult_aspects.all %}
            <li>
                <strong>Place:</strong> {{ aspect.cult_place|default:"Not specified" }}<br>
                <strong>Pilgrimage Site:</strong> {{ aspect.pilgrimage_site|default:"Not specified" }}<br>
                <strong>Status:</strong> {{ aspect.status|default:"Not specified" }}<br>
                <strong>Activities:</strong> {{ aspect.activities_accompanying_cult|default:"Not specified" }}<br>
                <strong>Relics:</strong> {{ aspect.relics_cult_related_objects|default:"Not specified" }}<br>
                <strong>Miracles:</strong> {{ aspect.miracles|default:"Not specified" }}
            </li>
            {% empty %}
            <li>No cult aspects recorded.</li>
            {% endfor %}
        </ul>

        <!-- Archaeological Evidence -->
        <div class="section-title">Archaeological / Architectural Evidence</div>
        <ul>
            {% for evidence in saint.archaeological_evidence.all %}
            <li>
                <strong>Type:</strong> {{ evidence.get_cult_buildings_display|default:"Not specified" }}<br>
                <strong>Location:</strong> {{ evidence.location|default:"Not specified" }}<br>
                <strong>Period:</strong>
                {{ evidence.date_1|default:"" }}
                {% if evidence.date_2 %} - {{ evidence.date_2 }}{% endif %}
                {% if evidence.date_text %} ({{ evidence.date_text }}){% endif %}
                {% if not evidence.date_1 and not evidence.date_2 and not evidence.date_text %}
                Not specified
                {% endif %}
                <br>
                <strong>Condition:</strong> {{ evidence.current_condition|default:"Not specified" }}
            </li>
            {% empty %}
            <li>No archaeological evidence available.</li>
            {% endfor %}
        </ul>

        <!-- Images Gallery -->
        <div class="section-title">Images</div>
        <div class="gallery row">
            {% for image in saint.images.all %}
            <div class="col-md-5 mb-3">
                <div class="card h-100">
                    {% if image.image %}
                    <img src="{{ image.image.url }}" class="card-img-top"
                        alt="{{ image.description|default:'Image of saint' }}">
                    {% else %}
                    <img src="{% static 'placeholder.png' %}" class="card-img-top" alt="No image available">
                    {% endif %}

                    <div class="card-body">
                        {% if image.get_material_technique_display %}
                        <p><strong>Material/Technique:</strong> {{ image.get_material_technique_display }}</p>
                        {% endif %}

                        {% if image.site_monument %}
                        <p><strong>Site/Monument:</strong> {{ image.site_monument }}</p>
                        {% endif %}

                        {% if image.century %}
                        <p><strong>Century:</strong> {{ image.century }}</p>
                        {% endif %}

                        {% if image.location_of_portrait %}
                        <p>
                            <strong>Portrait Location:</strong> {{ image.location_of_portrait }}
                            {% if image.location_of_portrait_text %}- {{ image.location_of_portrait_text }}{% endif %}
                        </p>
                        {% endif %}

                        {% if image.has_inscription %}
                        <p><strong>Inscription:</strong> {{ image.inscription_text|default:"Not specified" }}</p>
                        {% endif %}

                        {% if image.description %}
                        <p><strong>Description:</strong> {{ image.description }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% empty %}
            <p>No images available.</p>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Bibliography -->
<div class="section-title">Bibliography</div>
<ul>
    {% for ref in saint.bibliographies.all %}
    <li>{{ ref.reference|default:"Not specified" }}</li>
    {% empty %}
    <li>No bibliography available.</li>
    {% endfor %}
</ul>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var map = L.map('saint-map').setView([35.1264, 33.4299], 9);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        var markers = {{ markers_json| safe
    }};

    markers.forEach(function (m) {
        L.marker([m.lat, m.lng]).bindPopup(m.label).addTo(map);
    });

    if (markers.length > 0) {
        var group = L.featureGroup(
            markers.map(function (m) { return L.marker([m.lat, m.lng]); })
        );
        map.fitBounds(group.getBounds().pad(0.2));
    }
    });
</script>
{% endblock %}