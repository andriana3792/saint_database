{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ saint.name|default:"Unnamed Saint" }} - MapLoS Cy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            font-family: 'Segoe UI', sans-serif;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem;
            border-radius: 10px;
            background: #6b85b1;
            color: rgb(212, 220, 243);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .footer-logos img {
            height: 60px;
            width: auto;
        }
        footer {
            flex-shrink: 0;
            background-color: #f8f9fa;
            padding: 20px 0;
            border-radius: 40px;
        }
        .footer-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .footer-button {
            text-align: center;
            flex: 1;
        }
        .footer-logos {
            flex: 1;
            text-align: right;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            flex-wrap: nowrap;
        }
        .footer-text {
            text-align: right;
            margin-right: 0.5%;
            margin-top: 15px;
            font-size: 0.9rem;
            color: #0c0338;
        }
        .detail-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
            background: white;
            border-radius: 40px;
            padding: 2rem;
        }

        .detail-left img {
            max-width: 250px;
            border-radius: 12px;
            margin-bottom: 1rem;
        }

        .section-title {
            font-weight: 600;
            color: #6b85b1;
            margin-top: 1.5rem;
            border-bottom: 2px solid #e0f0ff;
        }

        .gallery {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .gallery img {
            max-width: 200px;
            border-radius: 10px;
            transition: transform 0.3s;
        }

        .gallery img:hover {
            transform: scale(1.05);
        }

        #saint-map {
            height: 400px;
            width: 100%;
            border-radius: 12px;
            margin-bottom: 1rem;
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>MapLoS Cy</h1>
        <p class="lead">Details</p>
    </div>

    <a href="{% url 'saint-list' %}" class="back-btn"><i class="fas fa-arrow-left me-1"></i>Back to Saints</a>

    <div class="detail-container">
        <!-- Left Column -->
        <div class="detail-left">
            {% with image=saint.get_default_image %}
            {% if image %}
            <img src="{{ image.image.url }}" alt="Portrait of {{ saint.name|default:'Saint' }}">
            {% else %}
            <img src="{% static 'saints/placeholder.png' %}" alt="No image available">
            {% endif %}
            {% endwith %}
        </div>

        <!-- Right Column -->
        <div class="detail-right">
            <h1>{{ saint.name|default:"Unnamed Saint" }}</h1>

            <div><strong>Gender:</strong> {{ saint.gender|default:"Not specified" }}</div>
            <div><strong>Type:</strong> {{ saint.type_of_saint|default:"Not specified" }}</div>
            <div><strong>Active period:</strong>
                {% if saint.act_period_1 %}{{ saint.act_period_1 }}{% endif %}
                {% if saint.act_period_2 %}, {{ saint.act_period_2 }}{% endif %}
                {% if saint.act_period_text %} ({{ saint.act_period_text }}){% endif %}
                {% if not saint.act_period_1 and not saint.act_period_2 and not saint.act_period_text %}Not
                specified{%endif %}
            </div>
            <div><strong>Region of Birth:</strong> {{ saint.region_of_birth|default:"Not specified" }}</div>
            <div><strong>Region of Burial:</strong> {{ saint.region_of_burial|default:"Not specified" }}</div>
            {% if saint.feast_day %}
            <div><strong>Feast Day:</strong> {{ saint.feast_day }}</div>
            {% endif %}

            <!-- Map -->
            <div class="section-title">Locations Map - Cyprus</div>
            <div id="saint-map"></div>

            <!-- Hagiographies -->
            <div class="section-title">Hagiographies / Written Sources</div>
            <ul>
                {% for h in saint.hagiographies.all %}
                <li>
                    <strong>Literary:</strong> {{ h.title_literary_text|default:"Not specified" }}<br>
                    <strong>Century:</strong> {{ h.date_or_century_of_source|default:"Not specified" }}<br>
                    <strong>Type:</strong> {{ h.literary_source_type|default:"Not specified" }}<br><br>
                    <strong>Liturgical:</strong> {{ h.title_liturgical_text|default:"Not specified" }}<br>
                    <strong>Century:</strong> {{ h.date_or_century_of_liturgical_source|default:"Not specified" }}<br>
                    <strong>Type:</strong> {{ h.liturgical_texts_source_type|default:"Not specified" }}
                </li>
                {% empty %}
                <li>No hagiographies available.</li>
                {% endfor %}
            </ul>

            <!-- Aspects of Cult -->
            <div class="section-title">Aspects of Cult</div>
            <ul>
                {% for aspect in saint.cult_aspects.all %}
                <li>
                    <strong>Place:</strong> {{ aspect.cult_place|default:"Not specified" }}<br>
                    <strong>Pilgrimage Site:</strong> {{ aspect.pilgrimage_site|default:"Not specified" }}<br>
                    <strong>Status:</strong> {{ aspect.status|default:"Not specified" }}<br>
                    <strong>Activities:</strong> {{ aspect.activities_accompanying_cult|default:"Not specified" }}<br>
                    <strong>Relics:</strong> {{ aspect.relics_cult_related_objects|default:"Not specified" }}<br>
                    <strong>Miracles:</strong> {{ aspect.miracles|default:"Not specified" }}
                </li>
                {% empty %}
                <li>No cult aspects recorded.</li>
                {% endfor %}
            </ul>

            <!-- Archaeological Evidence -->
            <div class="section-title">Archaeological / Architectural Evidence</div>
            <ul>
                {% for evidence in saint.archaeological_evidence.all %}
                <li>
                    <strong>Type:</strong> {{ evidence.get_cult_buildings_display|default:"Not specified" }}<br>
                    <strong>Location:</strong> {{ evidence.location|default:"Not specified" }}<br>
                    <strong>Period:</strong> {{ evidence.date_1|default:"" }}{% if evidence.date_2 %} - {{
                    evidence.date_2 }}{% endif %}{% if evidence.date_text %} ({{ evidence.date_text }}){% endif %}{% if
                    not evidence.date_1 and not evidence.date_2 and not evidence.date_text %}Not specified{% endif
                    %}<br>
                    <strong>Condition:</strong> {{ evidence.current_condition|default:"Not specified" }}
                </li>
                {% empty %}
                <li>No archaeological evidence available.</li>
                {% endfor %}
            </ul>

            <!-- Images Gallery -->
        <div class="section-title">Images</div>
        <div class="gallery row">
            {% for image in saint.images.all %}
            <div class="col-md-5 mb-3">
                <div class="card h-100">
                    {% if image.image %}
                    <img src="{{ image.image.url }}" class="card-img-top"
                        alt="{{ image.description|default:'Image of saint' }}">
                    {% else %}
                    <img src="{% static 'saints/placeholder.png' %}" class="card-img-top" alt="No image available">
                    {% endif %}
                    <div class="card-body">
                        {% if image.get_material_technique_display %}
                        <p><strong>Material/Technique:</strong> {{ image.get_material_technique_display }}</p>
                        {% endif %}
                        {% if image.site_monument %}
                        <p><strong>Site/Monument:</strong> {{ image.site_monument }}</p>
                        {% endif %}
                        {% if image.century %}
                        <p><strong>Century:</strong> {{ image.century }}</p>
                        {% endif %}
                        {% if image.location_of_portrait %}
                        <p><strong>Portrait Location:</strong> {{ image.location_of_portrait }}
                            {% if image.location_of_portrait_text %} - {{ image.location_of_portrait_text }}{% endif %}
                        </p>
                        {% endif %}
                        {% if image.has_inscription %}
                        <p><strong>Inscription:</strong> {{ image.inscription_text|default:"Not specified" }}</p>
                        {% endif %}
                        {% if image.description %}
                        <p><strong>Description:</strong> {{ image.description }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% empty %}
            <p>No images available.</p>
            {% endfor %}
        </div>

            </div>
        </div>

    </div>

    <!-- Bibliography -->
    <div class="section-title">Bibliography</div>
    <ul>
        {% for ref in saint.bibliographies.all %}
        <li>{{ ref.reference|default:"Not specified" }}</li>
        {% empty %}
        <li>No bibliography available.</li>
        {% endfor %}
    </ul>
    </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var map = L.map('saint-map').setView([35.1264, 33.4299], 9);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

            var markers = {{ markers_json| safe}};
        markers.forEach(m => {
            L.marker([m.lat, m.lng]).bindPopup(m.label).addTo(map);
        });

        if (markers.length > 0) {
            var group = L.featureGroup(markers.map(m => L.marker([m.lat, m.lng])));
            map.fitBounds(group.getBounds().pad(0.2));
        }
        });
    </script>

    <!-- Footer -->
    <footer>
        <div class="footer-row">
            <div style="flex:1;"></div>
            <div class="footer-button">
                {% if user.is_staff %}
                <a href="{% url 'admin:index' %}" class="btn btn-outline-primary">
                    <i class="fas fa-cog me-1"></i>Back to Admin
                </a>
                {% endif %}
            </div>
            <div class="footer-logos">
                <img src="/saint_images/thumbnail_MAPLOS CY_LOGO.jpg" alt="Logo">
                <img src="/saint_images/EN Co-Funded by the EU_POS (1).png" alt="EU Co-Funded Logo">
                <img src="/saint_images/CYPRUS REPUBLIC-EG (1).jpg" alt="Cyprus Republic Logo">
                <img src="/saint_images/logoENpng5 (1).png" alt="Logo EN">
            </div>
        </div>
        <div class="footer-text">
            MapLoS Cy - Mapping the Cult of Local Saints in Cyprus: Sites and Images (11th - 15th Century)
            (EXCELLENCE/0524/0433)
        </div>
    </footer>
</body>

</html>